<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <!--<meta name="viewport" content="width=device-width,initial-scale=1" />-->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Control de Ventas e Inventario</title>
  <link rel="stylesheet" href="style.css">
  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-auth-compat.js"></script>

  
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  

</head>
<body>
  
  <!-- ğŸ” LOGIN -->
  <div id="loginContainer">
    <h3>ğŸ” Iniciar sesiÃ³n</h3>
    <input type="email" id="email" placeholder="Correo electrÃ³nico" /><br><br>
    <input type="password" id="password" placeholder="ContraseÃ±a" /><br><br>
    <button onclick="login()">Ingresar</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <!-- âœ… CONTENIDO PRINCIPAL (oculto hasta login) -->
  <div id="appContent" style="display:none;">
    <button onclick="logout()">ğŸšª Cerrar sesiÃ³n</button>

    <h2>ğŸ“¦ Control de Ventas e Inventario</h2>

    <div class="form-group">
      <div>
        <button id="btnPrintLabel" type="button" class="btn btn-secondary btnLargo" onclick="imprimirEtiqueta()">ğŸ–¨ï¸ Imprimir etiqueta</button>
        <button id="btnScanToggle" type="button" class="btn btn-primary btnLargo">ğŸ“· Escanear cÃ³digo</button>
        <div id="qr-reader" style="width: 300px; margin-top: 10px;"></div>
      </div><br>

      <div style="width: 390px;">
        <label for="buscarCodigo" class="labelInline">CÃ³digo del producto:</label>
        <div style="display: flex; align-items: center; gap: 4px;">
          <input id="buscarCodigo" type="text" placeholder="ğŸ” Buscar por cÃ³digo o nombre..." oninput="buscarPorCodigo(this.value)" style="flex: 1;" />
          <button type="button" id="btnCopiarCodigo" class="btn btn-secondary btnLargo" style="width:90px; height:35px; font-size15px;">
          ğŸ“‹ Combinar
         </button>

        </div>
      </div>
    </div>

    <div id="labelContainer" style="display:none; text-align:center;">
      <h3 id="productLabelName"></h3>
      <svg id="barcode"></svg>
    </div>

    <div class="row">
      <label>Producto:</label>
      <input type="text" id="producto" class="inputLargo" readonly placeholder="Selecciona producto" />
      <button class="small" id="btnEditarProductos" style="display:none;" onclick="abrirModalEditar('producto')">âš™ï¸ Editar productos</button>
    </div>

    <div class="row">
      <label>Talla:</label>
      <input type="text" id="talla" class="inputLargo" readonly placeholder="Selecciona talla" />
      <button class="small" id="btnEditarTallas" style="display:none;" onclick="abrirModalEditar('talla')">âš™ï¸ Editar tallas</button>
    </div>

    <div class="row">
      <label>Cantidad:</label>
      <input type="text" id="cantidad" class="inputLargo" readonly placeholder="0" />
    </div>

    <div class="row">
      <label>Precio Compra:</label>
      <input type="text" id="precioCompra" class="inputLargo" readonly />
    </div>

    <div class="row">
      <label>Precio Venta:</label>
      <input type="text" id="precioVenta" class="inputLargo" readonly />
    </div>

    <div class="row">
      <button class="btnAccion" onclick="agregarProducto()" style="width:190px;">â• Agregar</button>
      <button class="btnAccion" onclick="venderProducto()" style="width:195px;">ğŸ’¸ Vender</button>
      
    </div>

    <div class="row">
      <button class="btnAccion" onclick="toggleMovimientos()" style="width:130px;">ğŸ“œ Movimientos</button>
      <button class="btnAccion" onclick="toggleInventario()" style="width:100px;">ğŸ“Š Inventario</button>
      <button class="btnAccion" id="btnToggleResumen" onclick="toggleResumen()" style="width:100px;">ğŸ“Š Resumen</button>
    </div>
    
    <!-- BOTÃ“N PARA ABRIR MODAL -->
    <div class="row">
      <button class="btnAccion" onclick="abrirModalReporte()" style="width:190px;">ğŸ“ˆ Reporte Inventario</button>
      <button class="btnAccion" onclick="abrirModalGenerarReporte() " style="width:195px;">ğŸ“ˆ Reporte de ventas</button>
    </div>

    <!-- MODAL PARA GENERAR REPORTE -->
    <div id="modalReporteVentas" style="
      display:none;
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:#0009;
      z-index:9999;
      justify-content:center;
      align-items:center;
    ">
      <div style="
        position: absolute;
        top: 20px;
        left: 0;
        background: white;
        padding: 20px;
        width: 80%;
        max-width: 600px;
        border-radius: 12px;
        text-align: left;
        margin: 0;

      ">

        <h3>ğŸ“Š Generar reporte de ventas</h3>

        <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center;">
          <label for="filtroFechaInicio" style="white-space: nowrap;">ğŸ“… Fecha inicio:</label>
          <input type="date" id="filtroFechaInicio" style="padding:5px;">

          <label for="filtroFechaFin" style="white-space: nowrap;">ğŸ“… Fecha fin:</label>
          <input type="date" id="filtroFechaFin" style="padding:5px;">
        </div>

        <br><br>

        <p>Â¿Deseas que el reporte incluya detalle por producto?</p>
        <button onclick="ejecutarReporte(true)">âœ”ï¸ SÃ­, incluir productos</button>
        <button onclick="ejecutarReporte(false)">âŒ No, solo totales</button>
        <button onclick="cerrarModalGenerarReporte()">âœ–ï¸ Cancelar</button>


      </div>
    </div>

    <!-- MODAL QUE MUESTRA EL RESULTADO -->
    <div id="modalResultadoReporte" style="
      position: absolute;
      top: 20px;
      left: 0;
      background: rgb(154, 152, 152);
      padding: 20px;
      width: 100%;
      max-width: 500px;
      border-radius: 12px;
      text-align: left;
      margin: 0;

    ">
      <div style="
        background: white;
        padding: 20px;
        width: 100%;
        max-width: 500px;
        border-radius: 12px;
        text-align: left;
        margin-left: 0;
        margin-right: auto;
      ">

        <h2 style="text-align:left;">ğŸ“ˆ Resultado del reporte</h2>

        <div id="contenedorReporteGenerado"></div>

        <br>

        <button onclick="cerrarModalResultadoReporte()" style="
          background:#b22;
          color:white;
          padding:8px 15px;
          display:block;
          margin:auto;
          border:none;
          border-radius:6px;
        ">
          âŒ Cerrar
        </button>
      </div>
    </div>


    <div class="summary" id="resumen" style="display:none;">
      <h3 id="totalInvertido">Total invertido: $0</h3>
      <h3 id="totalVendido">Total vendido: $0</h3>
      <h3 id="utilidad">Utilidad: $0</h3>
    </div>

    <section id="inventarioSection" class="hidden-section">
      <h3>ğŸ“¦ Inventario Actual</h3>
      <table id="tablaInventario">
        <thead>
          <tr><th>Producto</th><th>Talla</th><th>Cantidad</th><th>Compra</th><th>Venta</th><th>Invertido</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="movimientosSection" class="hidden-section">
      <h3>ğŸ“œ Historial de Movimientos</h3>
      <table id="tablaMovimientos">
        <thead>
          <tr><th>Tipo</th><th>Producto</th><th>Talla</th><th>Cantidad</th><th>Total</th><th>Fecha</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <div id="modal" class="modal" style="display:none; align-items:center;">
      <div id="contenidoModal" class="modal-content"></div>
    </div>
  </div>



  <script src="script.js"></script>
</body>
</html>
